USE [master]
GO
/****** Object:  Database [BBDDPROYECTO]    Script Date: 09/03/2024 21:48:08 ******/
CREATE DATABASE [BBDDPROYECTO]
 CONTAINMENT = NONE
 ON  PRIMARY 
( NAME = N'BBDDPROYECTO', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL15.SQLEXPRESS\MSSQL\DATA\BBDDPROYECTO.mdf' , SIZE = 8192KB , MAXSIZE = UNLIMITED, FILEGROWTH = 65536KB )
 LOG ON 
( NAME = N'BBDDPROYECTO_log', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL15.SQLEXPRESS\MSSQL\DATA\BBDDPROYECTO_log.ldf' , SIZE = 8192KB , MAXSIZE = 2048GB , FILEGROWTH = 65536KB )
 WITH CATALOG_COLLATION = DATABASE_DEFAULT
GO
ALTER DATABASE [BBDDPROYECTO] SET COMPATIBILITY_LEVEL = 150
GO
IF (1 = FULLTEXTSERVICEPROPERTY('IsFullTextInstalled'))
begin
EXEC [BBDDPROYECTO].[dbo].[sp_fulltext_database] @action = 'enable'
end
GO
ALTER DATABASE [BBDDPROYECTO] SET ANSI_NULL_DEFAULT OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET ANSI_NULLS OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET ANSI_PADDING OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET ANSI_WARNINGS OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET ARITHABORT OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET AUTO_CLOSE OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET AUTO_SHRINK OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET AUTO_UPDATE_STATISTICS ON 
GO
ALTER DATABASE [BBDDPROYECTO] SET CURSOR_CLOSE_ON_COMMIT OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET CURSOR_DEFAULT  GLOBAL 
GO
ALTER DATABASE [BBDDPROYECTO] SET CONCAT_NULL_YIELDS_NULL OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET NUMERIC_ROUNDABORT OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET QUOTED_IDENTIFIER OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET RECURSIVE_TRIGGERS OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET  DISABLE_BROKER 
GO
ALTER DATABASE [BBDDPROYECTO] SET AUTO_UPDATE_STATISTICS_ASYNC OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET DATE_CORRELATION_OPTIMIZATION OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET TRUSTWORTHY OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET ALLOW_SNAPSHOT_ISOLATION OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET PARAMETERIZATION SIMPLE 
GO
ALTER DATABASE [BBDDPROYECTO] SET READ_COMMITTED_SNAPSHOT OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET HONOR_BROKER_PRIORITY OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET RECOVERY SIMPLE 
GO
ALTER DATABASE [BBDDPROYECTO] SET  MULTI_USER 
GO
ALTER DATABASE [BBDDPROYECTO] SET PAGE_VERIFY CHECKSUM  
GO
ALTER DATABASE [BBDDPROYECTO] SET DB_CHAINING OFF 
GO
ALTER DATABASE [BBDDPROYECTO] SET FILESTREAM( NON_TRANSACTED_ACCESS = OFF ) 
GO
ALTER DATABASE [BBDDPROYECTO] SET TARGET_RECOVERY_TIME = 60 SECONDS 
GO
ALTER DATABASE [BBDDPROYECTO] SET DELAYED_DURABILITY = DISABLED 
GO
ALTER DATABASE [BBDDPROYECTO] SET ACCELERATED_DATABASE_RECOVERY = OFF  
GO
ALTER DATABASE [BBDDPROYECTO] SET QUERY_STORE = OFF
GO
USE [BBDDPROYECTO]
GO
/****** Object:  Table [dbo].[CATEGORIAS_RESTAURANTES]    Script Date: 09/03/2024 21:48:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CATEGORIAS_RESTAURANTES](
	[IDCATEGORIA] [int] NOT NULL,
	[NOMBRECATEGORIA] [nvarchar](100) NOT NULL,
	[ICONO] [nvarchar](200) NULL,
 CONSTRAINT [PK_CATEGORIAS_RESTAURANTES] PRIMARY KEY CLUSTERED 
(
	[IDCATEGORIA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VALORACIONES_RESTAURANTE]    Script Date: 09/03/2024 21:48:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VALORACIONES_RESTAURANTE](
	[IDRESTAURANTE] [int] NOT NULL,
	[IDUSUARIO] [int] NOT NULL,
	[VALORACION] [int] NOT NULL,
 CONSTRAINT [PK_VALORACIONES_RESTAURANTE] PRIMARY KEY CLUSTERED 
(
	[IDRESTAURANTE] ASC,
	[IDUSUARIO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[RESTAURANTES]    Script Date: 09/03/2024 21:48:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RESTAURANTES](
	[IDRESTAURANTE] [int] NOT NULL,
	[NOMBRE] [nvarchar](100) NOT NULL,
	[CORREO] [nvarchar](100) NOT NULL,
	[TELEFONO] [nvarchar](9) NULL,
	[DIRECCION] [nvarchar](200) NOT NULL,
	[IMAGEN] [nvarchar](200) NOT NULL,
	[IDCATEGORIA] [int] NOT NULL,
	[TIEMPOENTREGA] [nvarchar](10) NULL,
 CONSTRAINT [PK_RESTAURANTES] PRIMARY KEY CLUSTERED 
(
	[IDRESTAURANTE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[V_RESTAURANTES]    Script Date: 09/03/2024 21:48:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE   VIEW [dbo].[V_RESTAURANTES]
AS
	SELECT R.IDRESTAURANTE, R.NOMBRE, R.TELEFONO, R.CORREO,
	R.DIRECCION, R.IMAGEN, R.TIEMPOENTREGA, CR.NOMBRECATEGORIA,
	CAST(ISNULL(AVG(V.VALORACION), 0) AS DECIMAL(4,2)) AS VALORACION
	FROM RESTAURANTES R
	INNER JOIN CATEGORIAS_RESTAURANTES CR
	ON R.IDCATEGORIA = CR.IDCATEGORIA
	LEFT JOIN VALORACIONES_RESTAURANTE V
	ON R.IDRESTAURANTE = V.IDRESTAURANTE
	GROUP BY R.IDRESTAURANTE, R.NOMBRE, R.TELEFONO, R.CORREO,
	R.DIRECCION, R.IMAGEN, R.TIEMPOENTREGA, CR.NOMBRECATEGORIA
GO
/****** Object:  Table [dbo].[ESTADOS_PEDIDOS]    Script Date: 09/03/2024 21:48:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ESTADOS_PEDIDOS](
	[IDESTADO] [int] NOT NULL,
	[NOMBRE] [nvarchar](50) NOT NULL,
 CONSTRAINT [PK_ESTADOS_PEDIDOS] PRIMARY KEY CLUSTERED 
(
	[IDESTADO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PEDIDOS]    Script Date: 09/03/2024 21:48:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PEDIDOS](
	[IDPEDIDO] [int] NOT NULL,
	[IDUSUARIO] [int] NOT NULL,
	[IDRESTAURANTE] [int] NOT NULL,
	[ESTADO] [int] NOT NULL,
	[FECHA] [datetime] NULL,
 CONSTRAINT [PK_PEDIDOS] PRIMARY KEY CLUSTERED 
(
	[IDPEDIDO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PRODUCTOS]    Script Date: 09/03/2024 21:48:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PRODUCTOS](
	[IDPRODUCTO] [int] NOT NULL,
	[NOMBRE] [nvarchar](100) NOT NULL,
	[DESCRIPCION] [nvarchar](200) NULL,
	[PRECIO] [decimal](5, 2) NOT NULL,
	[IMAGEN] [nvarchar](200) NOT NULL,
	[IDRESTAURANTE] [int] NOT NULL,
 CONSTRAINT [PK_PRODUCTOS] PRIMARY KEY CLUSTERED 
(
	[IDPRODUCTO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PRODUCTOS_PEDIDO]    Script Date: 09/03/2024 21:48:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PRODUCTOS_PEDIDO](
	[IDPEDIDO] [int] NOT NULL,
	[IDPRODUCTO] [int] NOT NULL,
	[CANTIDAD] [int] NOT NULL,
 CONSTRAINT [PK_PRODUCTOS_PEDIDO] PRIMARY KEY CLUSTERED 
(
	[IDPEDIDO] ASC,
	[IDPRODUCTO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[V_PRODUCTOS_PEDIDO]    Script Date: 09/03/2024 21:48:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE   VIEW [dbo].[V_PRODUCTOS_PEDIDO] AS
	SELECT P.IDPEDIDO, PR.IDPRODUCTO, R.NOMBRE AS RESTAURANTE,
	E.NOMBRE AS ESTADO, PR.NOMBRE AS PRODUCTO, PR.PRECIO, PP.CANTIDAD
	FROM PEDIDOS P
	INNER JOIN PRODUCTOS_PEDIDO PP
	ON P.IDPEDIDO = PP.IDPEDIDO
	INNER JOIN RESTAURANTES R
	ON P.IDRESTAURANTE = R.IDRESTAURANTE
	INNER JOIN PRODUCTOS PR
	ON PR.IDPRODUCTO = PP.IDPRODUCTO
	INNER JOIN ESTADOS_PEDIDOS E
	ON P.ESTADO = E.IDESTADO
GO
/****** Object:  Table [dbo].[CATEGORIAS_PRODUCTOS]    Script Date: 09/03/2024 21:48:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CATEGORIAS_PRODUCTOS](
	[IDCATEGORIA] [int] NOT NULL,
	[NOMBRECATEGORIA] [nvarchar](100) NOT NULL,
 CONSTRAINT [PK_CATEGORIAS_PRODUCTOS] PRIMARY KEY CLUSTERED 
(
	[IDCATEGORIA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PRODUCTO_CATEGORIAS]    Script Date: 09/03/2024 21:48:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PRODUCTO_CATEGORIAS](
	[IDPRODUCTO] [int] NOT NULL,
	[IDCATEGORIA] [int] NOT NULL,
 CONSTRAINT [PK_PRODUCTO_CATEGORIAS] PRIMARY KEY CLUSTERED 
(
	[IDPRODUCTO] ASC,
	[IDCATEGORIA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TIPOS_USUARIOS]    Script Date: 09/03/2024 21:48:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TIPOS_USUARIOS](
	[IDTIPO] [int] NOT NULL,
	[NOMBRETIPO] [nvarchar](100) NOT NULL,
 CONSTRAINT [PK_TIPOS_USUARIOS] PRIMARY KEY CLUSTERED 
(
	[IDTIPO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[USUARIOS]    Script Date: 09/03/2024 21:48:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[USUARIOS](
	[IDUSUARIO] [int] NOT NULL,
	[NOMBRE] [nvarchar](200) NOT NULL,
	[CORREO] [nvarchar](100) NOT NULL,
	[CONTRASENYA] [varbinary](max) NOT NULL,
	[SALT] [nvarchar](50) NULL,
	[TELEFONO] [nvarchar](9) NULL,
	[DIRECCION] [nvarchar](200) NOT NULL,
	[TIPOUSUARIO] [int] NOT NULL,
 CONSTRAINT [PK_USUARIOS] PRIMARY KEY CLUSTERED 
(
	[IDUSUARIO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
INSERT [dbo].[CATEGORIAS_PRODUCTOS] ([IDCATEGORIA], [NOMBRECATEGORIA]) VALUES (1, N'Entrante')
GO
INSERT [dbo].[CATEGORIAS_PRODUCTOS] ([IDCATEGORIA], [NOMBRECATEGORIA]) VALUES (2, N'Principal')
GO
INSERT [dbo].[CATEGORIAS_PRODUCTOS] ([IDCATEGORIA], [NOMBRECATEGORIA]) VALUES (3, N'Postre')
GO
INSERT [dbo].[CATEGORIAS_PRODUCTOS] ([IDCATEGORIA], [NOMBRECATEGORIA]) VALUES (4, N'Carne')
GO
INSERT [dbo].[CATEGORIAS_PRODUCTOS] ([IDCATEGORIA], [NOMBRECATEGORIA]) VALUES (5, N'Pescado')
GO
INSERT [dbo].[CATEGORIAS_PRODUCTOS] ([IDCATEGORIA], [NOMBRECATEGORIA]) VALUES (6, N'Pollo')
GO
INSERT [dbo].[CATEGORIAS_PRODUCTOS] ([IDCATEGORIA], [NOMBRECATEGORIA]) VALUES (7, N'Vegetales')
GO
INSERT [dbo].[CATEGORIAS_PRODUCTOS] ([IDCATEGORIA], [NOMBRECATEGORIA]) VALUES (8, N'Vegano')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (1, N'Americana', N'americana.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (2, N'Burger', N'burger.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (3, N'Árabe', N'arabe.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (4, N'China', N'china.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (5, N'Sandwich', N'sandwich.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (6, N'Brunch', N'brunch.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (7, N'Dulces', N'dulces.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (8, N'Española', N'espanyola.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (9, N'Grill', N'grill.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (10, N'India', N'india.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (11, N'Italiana', N'italiana.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (12, N'Japonesa', N'japonesa.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (13, N'Mexicana', N'mexicana.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (14, N'Pastelería', N'pasteleria.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (15, N'Pizza', N'pizza.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (16, N'Pollo', N'pollo.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (17, N'Sushi', N'sushi.png')
GO
INSERT [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA], [NOMBRECATEGORIA], [ICONO]) VALUES (18, N'Saludable', N'saludable.png')
GO
INSERT [dbo].[ESTADOS_PEDIDOS] ([IDESTADO], [NOMBRE]) VALUES (1, N'SOLICITADO')
GO
INSERT [dbo].[ESTADOS_PEDIDOS] ([IDESTADO], [NOMBRE]) VALUES (2, N'PREPARANDO')
GO
INSERT [dbo].[ESTADOS_PEDIDOS] ([IDESTADO], [NOMBRE]) VALUES (3, N'EN PROCESO DE ENTREGA')
GO
INSERT [dbo].[ESTADOS_PEDIDOS] ([IDESTADO], [NOMBRE]) VALUES (4, N'ENTREGADO')
GO
INSERT [dbo].[PEDIDOS] ([IDPEDIDO], [IDUSUARIO], [IDRESTAURANTE], [ESTADO], [FECHA]) VALUES (1, 2, 1, 3, CAST(N'2024-03-06T19:39:25.000' AS DateTime))
GO
INSERT [dbo].[PEDIDOS] ([IDPEDIDO], [IDUSUARIO], [IDRESTAURANTE], [ESTADO], [FECHA]) VALUES (2, 2, 1, 1, CAST(N'2024-03-07T16:59:24.153' AS DateTime))
GO
INSERT [dbo].[PRODUCTO_CATEGORIAS] ([IDPRODUCTO], [IDCATEGORIA]) VALUES (4, 3)
GO
INSERT [dbo].[PRODUCTOS] ([IDPRODUCTO], [NOMBRE], [DESCRIPCION], [PRECIO], [IMAGEN], [IDRESTAURANTE]) VALUES (1, N'Pizza Fugazzeta Rellena', N'Extra de mozarrella, cebolla dulce, ají molido y orégano', CAST(28.00 AS Decimal(5, 2)), N'img1.jpeg', 1)
GO
INSERT [dbo].[PRODUCTOS] ([IDPRODUCTO], [NOMBRE], [DESCRIPCION], [PRECIO], [IMAGEN], [IDRESTAURANTE]) VALUES (2, N'Pizza Posta', N'Mozzarella, portobello, yema de huevo, trufa y parmesano
', CAST(23.00 AS Decimal(5, 2)), N'img2.jpeg', 1)
GO
INSERT [dbo].[PRODUCTOS] ([IDPRODUCTO], [NOMBRE], [DESCRIPCION], [PRECIO], [IMAGEN], [IDRESTAURANTE]) VALUES (3, N'Fainá o Farinata
', N'Harina de garbanzos, pimienta blanca y cebollino
', CAST(5.00 AS Decimal(5, 2)), N'img3.jpeg', 1)
GO
INSERT [dbo].[PRODUCTOS] ([IDPRODUCTO], [NOMBRE], [DESCRIPCION], [PRECIO], [IMAGEN], [IDRESTAURANTE]) VALUES (4, N'Tarta de Queso', N'Casera con mermelada', CAST(6.00 AS Decimal(5, 2)), N'img4.jpeg', 1)
GO
INSERT [dbo].[PRODUCTOS] ([IDPRODUCTO], [NOMBRE], [DESCRIPCION], [PRECIO], [IMAGEN], [IDRESTAURANTE]) VALUES (5, N'Pizza 4 Quesos', N'Mozzarella, parmesano, azul y stracciatella
', CAST(23.00 AS Decimal(5, 2)), N'img5.jpeg', 1)
GO
INSERT [dbo].[PRODUCTOS] ([IDPRODUCTO], [NOMBRE], [DESCRIPCION], [PRECIO], [IMAGEN], [IDRESTAURANTE]) VALUES (6, N'Pizza Fumé', N'Pesto, mozzarella, scarmorza ahumada, cebolla, orégano
', CAST(23.00 AS Decimal(5, 2)), N'img6.jpeg', 1)
GO
INSERT [dbo].[PRODUCTOS] ([IDPRODUCTO], [NOMBRE], [DESCRIPCION], [PRECIO], [IMAGEN], [IDRESTAURANTE]) VALUES (7, N'Ternera con Guindillas', N'Ternera, guindillas, perejil y soja', CAST(15.00 AS Decimal(5, 2)), N'img7.jpeg', 2)
GO
INSERT [dbo].[PRODUCTOS] ([IDPRODUCTO], [NOMBRE], [DESCRIPCION], [PRECIO], [IMAGEN], [IDRESTAURANTE]) VALUES (8, N'Arroz con Verdura y Carne Ahumada', N'Arroz, huevo, verdura y cerdo ahumado', CAST(10.50 AS Decimal(5, 2)), N'img8.jpeg', 2)
GO
INSERT [dbo].[PRODUCTOS] ([IDPRODUCTO], [NOMBRE], [DESCRIPCION], [PRECIO], [IMAGEN], [IDRESTAURANTE]) VALUES (9, N'Panceta de Mao', N'Panceta cocinada durante horas en azúcar, sal y especias', CAST(15.50 AS Decimal(5, 2)), N'img9.jpeg', 2)
GO
INSERT [dbo].[PRODUCTOS] ([IDPRODUCTO], [NOMBRE], [DESCRIPCION], [PRECIO], [IMAGEN], [IDRESTAURANTE]) VALUES (10, N'Panceta ahumada con ajetes tiernos', N'Panceta ahumada durante días con ajetes tiernos', CAST(15.00 AS Decimal(5, 2)), N'img10.jpeg', 2)
GO
INSERT [dbo].[PRODUCTOS] ([IDPRODUCTO], [NOMBRE], [DESCRIPCION], [PRECIO], [IMAGEN], [IDRESTAURANTE]) VALUES (11, N'Tallarines a las 36 especias', N'Uno de los platos más populares del desayuno en Hunan', CAST(12.00 AS Decimal(5, 2)), N'img11.jpeg', 2)
GO
INSERT [dbo].[PRODUCTOS_PEDIDO] ([IDPEDIDO], [IDPRODUCTO], [CANTIDAD]) VALUES (1, 1, 2)
GO
INSERT [dbo].[PRODUCTOS_PEDIDO] ([IDPEDIDO], [IDPRODUCTO], [CANTIDAD]) VALUES (1, 2, 1)
GO
INSERT [dbo].[PRODUCTOS_PEDIDO] ([IDPEDIDO], [IDPRODUCTO], [CANTIDAD]) VALUES (2, 4, 4)
GO
INSERT [dbo].[PRODUCTOS_PEDIDO] ([IDPEDIDO], [IDPRODUCTO], [CANTIDAD]) VALUES (2, 5, 1)
GO
INSERT [dbo].[RESTAURANTES] ([IDRESTAURANTE], [NOMBRE], [CORREO], [TELEFONO], [DIRECCION], [IMAGEN], [IDCATEGORIA], [TIEMPOENTREGA]) VALUES (1, N'Pizza Posta', N'pizzaposta@gmail.com', N'915700737', N'C/ Amparo 81, Madrid, Madrid 28012', N'img1.jpeg', 15, N'20')
GO
INSERT [dbo].[RESTAURANTES] ([IDRESTAURANTE], [NOMBRE], [CORREO], [TELEFONO], [DIRECCION], [IMAGEN], [IDCATEGORIA], [TIEMPOENTREGA]) VALUES (2, N'Chila', N'chilarestaurante@gmail.com', N'915302673', N'Calle De Silva 4, Madrid, Madrid 28013', N'img2.jpeg', 4, N'20')
GO
INSERT [dbo].[TIPOS_USUARIOS] ([IDTIPO], [NOMBRETIPO]) VALUES (1, N'USUARIO')
GO
INSERT [dbo].[TIPOS_USUARIOS] ([IDTIPO], [NOMBRETIPO]) VALUES (2, N'ADMIN')
GO
INSERT [dbo].[TIPOS_USUARIOS] ([IDTIPO], [NOMBRETIPO]) VALUES (3, N'EMPRESA')
GO
INSERT [dbo].[USUARIOS] ([IDUSUARIO], [NOMBRE], [CORREO], [CONTRASENYA], [SALT], [TELEFONO], [DIRECCION], [TIPOUSUARIO]) VALUES (1, N'admin', N'admin@gmail.com', 0x7468F39A121F6BDC36155670A60414B5303522F4306A185E39AA35E86B766C45ED2CBC36E96D1E6009B8641B823BD987A90B2BC8E529747B3A45D8F27DF5F059, N'ú©9ä¼³ºýò:dI*½óÚÉZ5ì9ym¹@á·µÇ6ñu[dsj64''l&$-', N'617812153', N'Calle Villaverde 14, Getafe, Madrid', 2)
GO
INSERT [dbo].[USUARIOS] ([IDUSUARIO], [NOMBRE], [CORREO], [CONTRASENYA], [SALT], [TELEFONO], [DIRECCION], [TIPOUSUARIO]) VALUES (2, N'Alejandro López Labajo', N'alopezlabajo.02@gmail.com', 0xA658D3FBAE1FFCDA5179DDD0A2F16A41348871010C5C87F80DAE2C03D3A3407CF818E4EF47F0C5D556F5966F4ACBB57C1CDE1154FBABCA49FE10A7950F6275CD, N'ª<CEéÎ&Ñ¹x]Dï&Y£,ìÀ=Òâé,@»À£aUÌýns¶''RG', N'617812153', N'Calle Vizconde de Arlessón, Madrid, Madrid', 1)
GO
INSERT [dbo].[USUARIOS] ([IDUSUARIO], [NOMBRE], [CORREO], [CONTRASENYA], [SALT], [TELEFONO], [DIRECCION], [TIPOUSUARIO]) VALUES (3, N'Prueba Usuario', N'pruebausuario@gmail.com', 0x4E392A7AB2BEE7379439D12BE0D96495F18A526576A788F5137EB563B3DB6B93F74A83CFBD850401E11E06AF76A9ED7CD597F46CC2DF000236B64A1642097F9A, N'ûÄº-)Ò*èª*¸Ð%¶ûMÖñÈýiÑ",r)S6°öÅþ¤zñà#/S\', N'643438790', N'C/ Princesa 56, Málaga, Málaga', 1)
GO
INSERT [dbo].[USUARIOS] ([IDUSUARIO], [NOMBRE], [CORREO], [CONTRASENYA], [SALT], [TELEFONO], [DIRECCION], [TIPOUSUARIO]) VALUES (4, N'Pizza Posta', N'pizzaposta@gmail.com', 0x376A43060B092E9B2D0B435C08C06B01B88C7307A2B397E8671F619202BF334F5A49B46EF116D71A38F93FBB59FDBA4B49713F3191A42CF97937F2C388718426, N'ËÑ£)Úê9XJ}]T¤pXæÅÞz0³°¿öÚüDÕ¹@y/aåÏ', N'915700737', N'C/ Amparo 81, Madrid, Madrid 28012', 3)
GO
INSERT [dbo].[USUARIOS] ([IDUSUARIO], [NOMBRE], [CORREO], [CONTRASENYA], [SALT], [TELEFONO], [DIRECCION], [TIPOUSUARIO]) VALUES (5, N'Chila', N'chilarestaurante@gmail.com', 0xCF1F7932D021FF10EB3001FB7EE61650BC5987F7788E52EE6D20DC92EBB56FCBA17D41CA0A0311153E8771711422D409E863A52A074B943CE1AD9BB0A782A6DC, N'²ºßøQ¸>¹rZ<í\®Õ¨"¶TÉEV bþ17*ïcz \+P¹U#½Ï', N'915302673', N'Calle De Silva 4, Madrid, Madrid 28013', 3)
GO
INSERT [dbo].[VALORACIONES_RESTAURANTE] ([IDRESTAURANTE], [IDUSUARIO], [VALORACION]) VALUES (1, 1, 4)
GO
INSERT [dbo].[VALORACIONES_RESTAURANTE] ([IDRESTAURANTE], [IDUSUARIO], [VALORACION]) VALUES (1, 2, 5)
GO
INSERT [dbo].[VALORACIONES_RESTAURANTE] ([IDRESTAURANTE], [IDUSUARIO], [VALORACION]) VALUES (2, 1, 3)
GO
INSERT [dbo].[VALORACIONES_RESTAURANTE] ([IDRESTAURANTE], [IDUSUARIO], [VALORACION]) VALUES (2, 2, 4)
GO
/****** Object:  Index [UNIQUE_CORREO_RESTAURANTES]    Script Date: 09/03/2024 21:48:09 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UNIQUE_CORREO_RESTAURANTES] ON [dbo].[RESTAURANTES]
(
	[IDRESTAURANTE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [UNIQUE_CORREO_USUARIOS]    Script Date: 09/03/2024 21:48:09 ******/
ALTER TABLE [dbo].[USUARIOS] ADD  CONSTRAINT [UNIQUE_CORREO_USUARIOS] UNIQUE NONCLUSTERED 
(
	[CORREO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
ALTER TABLE [dbo].[PEDIDOS]  WITH CHECK ADD  CONSTRAINT [FK_PEDIDOS_ESTADOS_PEDIDOS] FOREIGN KEY([ESTADO])
REFERENCES [dbo].[ESTADOS_PEDIDOS] ([IDESTADO])
GO
ALTER TABLE [dbo].[PEDIDOS] CHECK CONSTRAINT [FK_PEDIDOS_ESTADOS_PEDIDOS]
GO
ALTER TABLE [dbo].[PEDIDOS]  WITH CHECK ADD  CONSTRAINT [FK_PEDIDOS_RESTAURANTES] FOREIGN KEY([IDRESTAURANTE])
REFERENCES [dbo].[RESTAURANTES] ([IDRESTAURANTE])
GO
ALTER TABLE [dbo].[PEDIDOS] CHECK CONSTRAINT [FK_PEDIDOS_RESTAURANTES]
GO
ALTER TABLE [dbo].[PEDIDOS]  WITH CHECK ADD  CONSTRAINT [FK_PEDIDOS_USUARIOS] FOREIGN KEY([IDUSUARIO])
REFERENCES [dbo].[USUARIOS] ([IDUSUARIO])
GO
ALTER TABLE [dbo].[PEDIDOS] CHECK CONSTRAINT [FK_PEDIDOS_USUARIOS]
GO
ALTER TABLE [dbo].[PRODUCTO_CATEGORIAS]  WITH CHECK ADD  CONSTRAINT [FK_PRODUCTO_CATEGORIAS_CATEGORIAS_PRODUCTOS] FOREIGN KEY([IDCATEGORIA])
REFERENCES [dbo].[CATEGORIAS_PRODUCTOS] ([IDCATEGORIA])
GO
ALTER TABLE [dbo].[PRODUCTO_CATEGORIAS] CHECK CONSTRAINT [FK_PRODUCTO_CATEGORIAS_CATEGORIAS_PRODUCTOS]
GO
ALTER TABLE [dbo].[PRODUCTO_CATEGORIAS]  WITH CHECK ADD  CONSTRAINT [FK_PRODUCTO_CATEGORIAS_PRODUCTOS] FOREIGN KEY([IDPRODUCTO])
REFERENCES [dbo].[PRODUCTOS] ([IDPRODUCTO])
GO
ALTER TABLE [dbo].[PRODUCTO_CATEGORIAS] CHECK CONSTRAINT [FK_PRODUCTO_CATEGORIAS_PRODUCTOS]
GO
ALTER TABLE [dbo].[PRODUCTOS]  WITH CHECK ADD  CONSTRAINT [FK_PRODUCTOS_RESTAURANTES] FOREIGN KEY([IDRESTAURANTE])
REFERENCES [dbo].[RESTAURANTES] ([IDRESTAURANTE])
GO
ALTER TABLE [dbo].[PRODUCTOS] CHECK CONSTRAINT [FK_PRODUCTOS_RESTAURANTES]
GO
ALTER TABLE [dbo].[PRODUCTOS_PEDIDO]  WITH CHECK ADD  CONSTRAINT [FK_PRODUCTOS_PEDIDO_PEDIDOS] FOREIGN KEY([IDPEDIDO])
REFERENCES [dbo].[PEDIDOS] ([IDPEDIDO])
GO
ALTER TABLE [dbo].[PRODUCTOS_PEDIDO] CHECK CONSTRAINT [FK_PRODUCTOS_PEDIDO_PEDIDOS]
GO
ALTER TABLE [dbo].[PRODUCTOS_PEDIDO]  WITH CHECK ADD  CONSTRAINT [FK_PRODUCTOS_PEDIDO_PRODUCTOS] FOREIGN KEY([IDPRODUCTO])
REFERENCES [dbo].[PRODUCTOS] ([IDPRODUCTO])
GO
ALTER TABLE [dbo].[PRODUCTOS_PEDIDO] CHECK CONSTRAINT [FK_PRODUCTOS_PEDIDO_PRODUCTOS]
GO
ALTER TABLE [dbo].[RESTAURANTES]  WITH CHECK ADD  CONSTRAINT [FK_RESTAURANTES_CATEGORIAS_RESTAURANTES] FOREIGN KEY([IDCATEGORIA])
REFERENCES [dbo].[CATEGORIAS_RESTAURANTES] ([IDCATEGORIA])
GO
ALTER TABLE [dbo].[RESTAURANTES] CHECK CONSTRAINT [FK_RESTAURANTES_CATEGORIAS_RESTAURANTES]
GO
ALTER TABLE [dbo].[USUARIOS]  WITH CHECK ADD  CONSTRAINT [FK_USUARIOS_TIPOS_USUARIOS] FOREIGN KEY([TIPOUSUARIO])
REFERENCES [dbo].[TIPOS_USUARIOS] ([IDTIPO])
GO
ALTER TABLE [dbo].[USUARIOS] CHECK CONSTRAINT [FK_USUARIOS_TIPOS_USUARIOS]
GO
ALTER TABLE [dbo].[VALORACIONES_RESTAURANTE]  WITH CHECK ADD  CONSTRAINT [FK_VALORACIONES_RESTAURANTE_RESTAURANTES] FOREIGN KEY([IDRESTAURANTE])
REFERENCES [dbo].[RESTAURANTES] ([IDRESTAURANTE])
GO
ALTER TABLE [dbo].[VALORACIONES_RESTAURANTE] CHECK CONSTRAINT [FK_VALORACIONES_RESTAURANTE_RESTAURANTES]
GO
/****** Object:  StoredProcedure [dbo].[SP_CREATE_USUARIO]    Script Date: 09/03/2024 21:48:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE   PROCEDURE [dbo].[SP_CREATE_USUARIO]
(@NOMBRE NVARCHAR(100), @APELLIDOS NVARCHAR(100),
@CORREO NVARCHAR(100), @CONTRASENYA VARBINARY(MAX),
@TELEFONO NVARCHAR(9), @DIRECCION NVARCHAR(200),
@SALT NVARCHAR(50))
AS
	DECLARE @IDUSUARIO INT
	SELECT @IDUSUARIO = ISNULL(MAX(IDUSUARIO), 0) + 1
	FROM USUARIOS
	INSERT INTO USUARIOS VALUES
	(@IDUSUARIO, @NOMBRE, @APELLIDOS, @CORREO,
	@CONTRASENYA, @SALT, @TELEFONO, @DIRECCION, 1)
GO
/****** Object:  StoredProcedure [dbo].[SP_PRODUCTOS_CATEGORIA]    Script Date: 09/03/2024 21:48:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE   PROCEDURE [dbo].[SP_PRODUCTOS_CATEGORIA]
(@RESTAURANTE INT, @CATEGORIA INT)
AS
	SELECT P.IDPRODUCTO, P.NOMBRE, P.DESCRIPCION,
	P.PRECIO, P.IMAGEN, P.IDRESTAURANTE
	FROM PRODUCTOS P
	INNER JOIN PRODUCTO_CATEGORIAS PC
	ON P.IDPRODUCTO = PC.IDPRODUCTO
	WHERE PC.IDCATEGORIA = @CATEGORIA
	AND P.IDRESTAURANTE = @RESTAURANTE
GO
USE [master]
GO
ALTER DATABASE [BBDDPROYECTO] SET  READ_WRITE 
GO
